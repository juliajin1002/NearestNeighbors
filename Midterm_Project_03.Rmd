---
title: "Midterm_Project_03"
author: "Julia Jin"
date: "11/1/2021"
output: html_document
---

```{r init, include=F}
# The package "ezids" (EZ Intro to Data Science) includes a lot of the helper functions we developed for the course. 
# Some of the frequently used functions are loadPkg(), xkabledply(), xkablesummary(), uzscale(), etc.
# Once installed, load the library.
library(ezids)
library(dplyr)
library(ggplot2)
```


```{r setup, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
# knitr::opts_chunk$set(include = F)
# knitr::opts_chunk$set(echo = TRUE)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3) 
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```


```{r readData}
donation <- read.csv(file='UniversityDonations.csv')
donation$Year <- as.factor(donation$Year)
donation$State <- as.factor(donation$State)
summary(donation$Amount)
```

```{r boxplot, include = T}
boxplot(log(donation$Amount), col='blue', ylab="Gift Amount", title="University Donations")
axis(side = 4)
```
Obviously this is not normal.

Remove any outliers and test normality based on different subcategories.
```{r remove_outliers, results=T}
donation2 = outlierKD2(donation, Amount, rm=T, histogram = F)
str(donation2)
```

```{r boxplot_state, include = T}
loadPkg("ggplot2")
ggplot(donation2, aes(x=State, y=log10(Amount)))+geom_boxplot(outlier.size = 2)+labs(title = 'Gift amount vs. State', x='State', y='Amount (log10)')
```
```{r anova_state, results = T}
anovaState <- aov(log10(Amount)~State, data=donation2)
xkabledply(anovaState)
```
The p-value is close to 0, so we reject our null hypothesis, meaning we can say at least in one state, the mean of gift amount is different than in the other states.

### post hoc Tukey
```{r Tukey, results = F}
tukeyState <- TukeyHSD(anovaState)
tukeyState
```

The full result is lengthy, so I will not display everything here. 

But following pairwise comparisons have p-value smaller than the standard 0.05:
NE - CO, NY - CO, TX - CO
So we can say that the mean of donation in Colorado is different from that in Nebraska, New York and Texas.


### vs. College

```{r boxplot_college, include = T}
ggplot(donation2, aes(x=College, y=log10(Amount)))+geom_boxplot(outlier.size = 2)+labs(title = 'Gift amount vs. College', x='College', y='Amount (log10)')
```

```{r anova_college, results=T}
anovaCollege <- aov(log10(Amount)~College, data=donation2)
xkabledply(anovaCollege)
```
The p-value is 0.181 > 0.05, so we fail to reject the null hypothesis, meaning we can say the mean of gift amount among colleges are the same.

### vs. Year

```{r boxplot_year, include = T}
ggplot(donation2, aes(x=Year, y=log10(Amount)))+geom_boxplot(outlier.size = 2)+labs(title = 'Gift amount vs. Year', x='Year', y='Amount (log10)')
```

```{r anova_year, results=T}
anovaYear <- aov(log10(Amount)~Year, data=donation2)
xkabledply(anovaYear)
```
The p-value is 0.0925 > 0.05, so we fail to reject the null hypothesis, meaning we can say the mean of gift amount received in different years are the same.

### vs. Allocation

```{r boxplot_allocation, include = T}
ggplot(donation2, aes(x=Gift_Allocation, y=log10(Amount)))+geom_boxplot(outlier.size = 2)+labs(title = 'Gift amount vs. Allocation', x='Allocation', y='Amount (log10)')
```

```{r anova_allocation, results = T}
anovaAllocation <- aov(log10(Amount)~Gift_Allocation, data=donation2)
xkabledply(anovaAllocation)
```
The p-value is 0.793 > 0.05, so we fail to reject the null hypothesis, meaning we can say the mean of gift amount with different allocations are the same.

Further subcategorize each allocation method.
```{r subcategory, results = T}
campus_resource <- subset(donation2, Gift_Allocation=='Campus_Resource')
endowment <- subset(donation2, Gift_Allocation=='Endowment')
scholarship <- subset(donation2, Gift_Allocation == 'Scholarship')
```

```{r boxplot_campus, include = T}
ggplot(campus_resource, aes(x=Allocation_Subcategory, y=log10(Amount)))+geom_boxplot(outlier.size = 2)+labs(title = 'Gift amount vs. Campus Resources', x='Resource', y='Amount (log10)')
```

```{r anova_campus, results = T}
anovaCampus <- aov(log(Amount)~Allocation_Subcategory, data=campus_resource)
xkabledply(anovaCampus)
```
The p-value is 0.222 > 0.05, so we cannot reject our null hypothesis, meaning we can say the mean of gift amount among different resources are the same.

```{r boxplot_endowment, include = T}
ggplot(endowment, aes(x=Allocation_Subcategory, y=log10(Amount)))+geom_boxplot(outlier.size = 2)+labs(title = 'Gift amount vs. Endowment', x='Endowment', y='Amount (log10)')
```

```{r anova_endowment, results = T}
anovaEndowment <- aov(log10(Amount)~Allocation_Subcategory, data=endowment)
xkabledply(anovaEndowment)
```
The p-value is 0.850 > 0.05, so we cannot reject our null hypothesis, meaning we can say the mean of gift amount among different endowments are the same.

```{r boxplot_scholarship, include = T}
ggplot(scholarship, aes(x=Allocation_Subcategory, y=log10(Amount)))+geom_boxplot(outlier.size = 2)+labs(title = 'Gift amount vs. Scholarship', x='Scholarship', y='Amount (log10)')
```

```{r anova_scholarship, results = T}
anovaScholarship <- aov(log10(Amount)~Allocation_Subcategory, data=scholarship)
xkabledply(anovaScholarship)
```
The p-value is 0.677 > 0.05, so we cannot reject our null hypothesis, meaning we can say the mean of gift amount among different resources is the same.

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
